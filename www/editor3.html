<!DOCTYPE html>
<html>
<head>
    <title>Example formBuilder</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/styles/default.min.css">
    <script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/highlight.min.js"></script>
    <script src="https://formbuilder.online/assets/js/form-render.min.js"></script>
</head>
<body>
    <script>
        jQuery($ => {
        const escapeEl = document.createElement("textarea");
        const code = document.getElementById("edit_form");
        const formData = '#formData#';
        const addLineBreaks = html => html.replace(new RegExp("><", "g"), ">\n<");


/*
        var options = {
      onSave: function(evt, formData) {
          toggleEdit();
          $('.render-wrap').formRender({formData});
          window.sessionStorage.setItem('formData', JSON.stringify(formData));
        },
    };
*/
  var formRenderOptions = {
  formData: formData,
  onSave: function(evt, formData) { alert("moi");}
}
 
      
        // Grab edit_form and escape it
        const $edit_form = $("<div/>");
        $edit_form.formRender({ formData });
       // $edit_form.formRender( formRenderOptions );
       // alert($edit_form.formRender("html"));
      
        // set < code > innerText with escaped edit_form
        //code.innerText = addLineBreaks($edit_form.formRender("html"));
            
        //code.innerText = $edit_form.formRender("html");
        code.innerHTML = $edit_form.formRender( "html" );
      
        //hljs.highlightBlock(code);

   
    function logSubmit(event) {
        console.log( `Form Submitted! Time stamp: ${event.timeStamp}`);
        //console.log(JSON.stringify(formData));
        formDataSave = $('form').serializeArray();
         
        console.log(formDataSave);
        //console.log($('form').serialize());
        /*
        $.post("/editor", formDataSave, function (data) {
                    alert("ok");
                });

*/
                $.ajax({
                type: "POST",
                url: "/editor",
                // The key needs to match your method's input parameter (case-sensitive).
                data: JSON.stringify({  type : 'channel', data: formDataSave }),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function(data){alert(data);},
                error: function(errMsg) {
                //    alert(errMsg);
                }
            });
        event.preventDefault();
        }
    document.getElementById("edit_form").addEventListener('submit', logSubmit);

        
      });
      </script>
<form id="edit_form"></form>
 
</body>
</html>



